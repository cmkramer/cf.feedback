"use strict";angular.module("cf.feedback",["pascalprecht.translate"]),angular.module("cf.feedback").constant("FEEDBACK_TYPE",{SUCCESS:"SUCCESS",ERROR:"ERROR",ALERT:"ALERT",NOTICE:"NOTICE"}),angular.module("cf.feedback").directive("feedback",["$timeout","cfFeedback",function(e,t){return{scope:{fbOptions:"=",elementId:"@feedback"},restrict:"A",controller:"FeedbackCtrl",transclude:!0,compile:function(e,n,a){return function(n){var i=function(e){n.handle(e)};""===n.elementId&&(n.elementId=void 0),t.subscribe(i,n.elementId),n.$on("$destroy",function(){t.unsubscribe(i,n.elementId)}),a(n,function(t){e.append(t)})}}}}]).controller("FeedbackCtrl",["$scope","$timeout","cfFeedback","$translate","FEEDBACK_TYPE",function(e,t,n,a,i){var c=this,r=0,s=null,o=[],u=0,f=n.getDefaultOptions();e.fbOptions&&(f=angular.extend({},f,e.fbOptions)),e.handle=function(e){l(e)},1!==f.maxMessages&&(e.feedback=[]),this.hide=function(n,a){1===f.maxMessages?(e.feedback=null,t(function(){u--,"function"==typeof a&&a()},f.replaceTime),e.$digest()):angular.forEach(e.feedback,function(i){if(i.index===n){u++,null!==i.timeout&&clearTimeout(i.timeout);for(var c=0;c<e.feedback.length;c++)if(e.feedback[c].index===n){e.feedback.splice(c,1);break}t(function(){u--,"function"==typeof a&&a()},f.replaceTime),e.$digest()}})};var l=function(e){var t={staticType:e.type},n=d(e.message);n?(t.paths=m(e.type,n),C(t),t.reference=t.paths.reference,t.message=t.reference+" (untranslated)"):(t.message=e.message,t.reference=t.message),t.details=null,t.type=e.type.toLowerCase(),t.data=e.data,p(t)&&g(t)},d=function(e){return"{"===e[0]&&"}"===e[e.length-1]?e.substring(1,e.length-1):!1},p=function(t){if(f.allowDuplicateStacked)return!0;var n=!0,a=function(e){e.type===t.type&&e.reference===t.reference&&(n=!1)};return 1===f.maxMessages&&e.feedback?a(e.feedback):angular.forEach(e.feedback,function(e){a(e)}),n},g=function(t){1===f.maxMessages&&e.feedback||1!==f.maxMessages&&e.feedback.length+u>=f.maxMessages?(y(i.NOTICE),1!==f.maxMessages||t.reference!==e.feedback.reference||o.length?E(t):h(t)):b(t)},m=function(e,t){var a=n.listTranslations();if(!a.FEEDBACK)throw new Error("Cannot find a FEEDBACK root constant reference in your loaded translations file. Make sure there is a root item called FEEDBACK in your translation file which contains all structured supported feedback messages.");var i,c,r,s=t.split("."),o="";if(i=a.FEEDBACK[e],!i)throw new Error("Cannot find FEEDBACK."+e+" in your translation file. Make sure you group your feedback by type in the translation file.");for(var u=0;u<s.length;u++){if(o+=u>0?"."+s[u]:s[u],!i[s[u]]){i=!1,c?console.debug("untranslated "+e.toLowerCase()+" feedback reference provided: "+t+". Falling back to most specific message: "+c):(r={reference:"UNKNOWN",message:"UNKNOWN"},console.debug("untranslated "+e.toLowerCase()+" feedback reference provided: "+t));break}i=i[s[u]],i._MESSAGE&&(c=o)}return i&&(r="object"==typeof i?{reference:t,message:c}:t),r},b=function(t,n){t.index=r++,r>2*f.maxMessages&&(r=0),1!==f.maxMessages?e.feedback.push(t):e.feedback=t,k(t,n||f.cleanTimeout)},E=function(t){var n=1===f.maxMessages?e.feedback:e.feedback[0];(null===s||s===i.NOTICE&&t.staticType!==i.NOTICE)&&(t.staticType!==i.NOTICE?k(n,f.minTimeout):k(n,f.queueTimeout),s=t.staticType),y(t)||o.push(t)},h=function(n){t(function(){c.hide(n[0].index,function(){b(n)}),e.$digest()})},k=function(t,n){t.timeout=setTimeout(function(){c.hide(t.index,function(){T()||(s=null)}),e.$digest()},n)},T=function(){if(o.length){var e;e=o.length>1?o[1].staticType!==i.NOTICE?f.minTimeout:f.queueTimeout:f.cleanTimeout,b(o[0],e),o.splice(0,1)}return o.length},y=function(e){for(var t=0;t<o.length;t++)if(o[t].staticType===e.staticType&&(!e||o[t].reference===e.reference))return o.splice(t--,1),!1},C=function(e){"object"==typeof e.paths?(a("FEEDBACK."+e.staticType+"."+e.paths.message+"._MESSAGE",e.data).then(function(t){e.message=t}),a("FEEDBACK."+e.staticType+"."+e.paths.reference+"._DETAILS",e.data).then(function(t){e.details=t})):a("FEEDBACK."+e.staticType+"."+e.paths,e.data).then(function(t){e.message=t})}}]),angular.module("cf.feedback").provider("cfFeedback",function(){var e,t,n=!1,a={global:[],identified:{}},i={replaceTime:300,cleanTimeout:6e3,queueTimeout:3e3,minTimeout:1e3,allowDuplicateStacked:!1,maxMessages:1};return{configureTranslations:function(a,i){e=a,t=i,n=!0},configureDefaultOptions:function(e){i=angular.extend({},i,e)},$get:function(){return{subscribe:function(e,t){void 0===t?a.global.push(e):(a.identified[t]=a.identified[t]||[],a.identified[t].push(e))},unsubscribe:function(e,t){for(var n=void 0===t?a.global:a.identified[t],i=0;i<n.length;i++)if(n[i]===e){n.splice(i,1);break}},publish:function(e){for(var t=void 0===e.contextElement?a.global:a.identified[e.contextElement],n=0;n<t.length;n++)"function"==typeof t[n]&&t[n](e)},getDefaultOptions:function(){return i},listTranslations:function(){return e.apply(this,arguments)},translate:function(){return n?t.apply(this,arguments):arguments[0]}}}}}),angular.module("cf.feedback").service("$feedback",["cfFeedback","FEEDBACK_TYPE",function(e,t){this.error=function(e,a,i){n(t.ERROR,e,a,i)},this.notice=function(e,a,i){n(t.NOTICE,e,a,i)},this.success=function(e,a,i){n(t.SUCCESS,e,a,i)},this.alert=function(e,a,i){n(t.ALERT,e,a,i)};var n=function(t,n,a,i){var c={message:n,type:t};void 0!==a&&(c.data=a),void 0!==i&&(c.contextElement=i),e.publish(c)}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbnN0YW50cy5qcyIsImRpcmVjdGl2ZS5qcyIsInNlcnZpY2UuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiU1VDQ0VTUyIsIkVSUk9SIiwiQUxFUlQiLCJOT1RJQ0UiLCJkaXJlY3RpdmUiLCIkdGltZW91dCIsImNmRmVlZGJhY2siLCJzY29wZSIsImZiT3B0aW9ucyIsImVsZW1lbnRJZCIsInJlc3RyaWN0IiwiY29udHJvbGxlciIsInRyYW5zY2x1ZGUiLCJjb21waWxlIiwidEVsZW1lbnQiLCJhdHRycyIsIiRzY29wZSIsImhhbmRsZUZlZWRiYWNrIiwiZmVlZGJhY2siLCJoYW5kbGUiLCJzdWJzY3JpYmUiLCIkb24iLCJ1bnN1YnNjcmliZSIsImNsb25lIiwiYXBwZW5kIiwiJHRyYW5zbGF0ZSIsIkZFRURCQUNLX1RZUEUiLCJ0aGF0IiwidGhpcyIsImluZGV4IiwidGltZW91dE92ZXJydWxpbmdUeXBlIiwicXVldWUiLCJoaWRpbmciLCJvcHRpb25zIiwiZ2V0RGVmYXVsdE9wdGlvbnMiLCJleHRlbmQiLCJtYXhNZXNzYWdlcyIsImhpZGUiLCJ3aGVuRG9uZSIsInJlcGxhY2VUaW1lIiwiJGRpZ2VzdCIsImZvckVhY2giLCJtZXNzYWdlIiwidGltZW91dCIsImNsZWFyVGltZW91dCIsImkiLCJsZW5ndGgiLCJzcGxpY2UiLCJmZWVkYmFja1NwZWMiLCJzdGF0aWNUeXBlIiwidHlwZSIsInRyYW5zbGF0YWJsZU1lc3NhZ2UiLCJ0cmFuc2xhdGFibGUiLCJwYXRocyIsImZpbmRSZWxhdGl2ZUZlZWRiYWNrUGF0aHMiLCJ0cmFuc2xhdGVGZWVkYmFjayIsInJlZmVyZW5jZSIsImRldGFpbHMiLCJ0b0xvd2VyQ2FzZSIsImRhdGEiLCJhbGxvd1Byb2Nlc3NpbmciLCJwcm9jZXNzTmV3RmVlZGJhY2tNZXNzYWdlIiwiZmVlZGJhY2tNZXNzYWdlIiwic3Vic3RyaW5nIiwiYWxsb3dEdXBsaWNhdGVTdGFja2VkIiwiYWxsb3ciLCJ2YWxpZGF0ZU1lc3NhZ2UiLCJjdXJyZW50RmVlZGJhY2siLCJjbGVhck9yVXBkYXRlUXVldWVkIiwicXVldWVGZWVkYmFjayIsInJlcGxhY2VGZWVkYmFjayIsInNob3dGZWVkYmFjayIsImZlZWRiYWNrVHlwZSIsInRyYW5zbGF0aW9ucyIsImxpc3RUcmFuc2xhdGlvbnMiLCJGRUVEQkFDSyIsIkVycm9yIiwidHJhdmVyc2VkIiwibGFzdE1lc3NhZ2VQYXRoIiwiZmIiLCJyZWYiLCJzcGxpdCIsInBhdGgiLCJjb25zb2xlIiwiZGVidWciLCJfTUVTU0FHRSIsInB1c2giLCJ0aW1lb3V0RmVlZGJhY2siLCJjbGVhblRpbWVvdXQiLCJmaXJzdEl0ZW0iLCJtaW5UaW1lb3V0IiwicXVldWVUaW1lb3V0Iiwic2V0VGltZW91dCIsImV2YWx1YXRlUXVldWUiLCJuZXh0VGltZW91dCIsInRoZW4iLCJ0cmFuc2xhdGVkRmVlZGJhY2siLCJwcm92aWRlciIsInRyYW5zbGF0aW9uTGlzdEZuIiwidHJhbnNsYXRpb25GbiIsInRyYW5zbGF0ZSIsImxpc3RlbmVycyIsImdsb2JhbCIsImlkZW50aWZpZWQiLCJkZWZhdWx0T3B0aW9ucyIsImNvbmZpZ3VyZVRyYW5zbGF0aW9ucyIsImxpc3RGbiIsInRyYW5zbGF0ZUZuIiwiY29uZmlndXJlRGVmYXVsdE9wdGlvbnMiLCIkZ2V0IiwiY2FsbGJhY2siLCJjb250ZXh0RWxlbWVudCIsInRhcmdldExpc3QiLCJwdWJsaXNoIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJzZXJ2aWNlIiwiZXJyb3IiLCJkaXNwYXRjaEZlZWRiYWNrIiwibm90aWNlIiwic3VjY2VzcyIsImFsZXJ0IiwidW5kZWZpbmVkIl0sIm1hcHBpbmdzIjoiQUFBQSxZQXdCQUEsU0FBUUMsT0FBTyxlQUFlLDJCQ2Y5QkQsUUFBUUMsT0FBTyxlQUNiQyxTQUFTLGlCQUNIQyxRQUFXLFVBQ1hDLE1BQVMsUUFDVEMsTUFBUyxRQUNUQyxPQUFVLFdDSmxCTixRQUFRQyxPQUFPLGVB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SzRGLFFBQVUsU0FBVTlFLEVBQVNpQixFQUFNb0QsR0FDcENPLEVBQWlCNUYsRUFBYzFCLFFBQVMwQyxFQUFTaUIsRUFBTW9ELElBRzNEbkYsS0FBSzZGLE1BQVEsU0FBVS9FLEVBQVNpQixFQUFNb0QsR0FDbENPLEVBQWlCNUYsRUFBY3hCLE1BQU93QyxFQUFTaUIsRUFBTW9ELEdBR3pELElBQUlPLEdBQW1CLFNBQVVwRSxFQUFNUixFQUFTaUIsRUFBTW9ELEdBQ2xELEdBQUk3RixJQUNBd0IsUUFBU0EsRUFDVFEsS0FBTUEsRUFFR3dFLFVBQVQvRCxJQUNBekMsRUFBU3lDLEtBQU9BLEdBRUcrRCxTQUFuQlgsSUFDQTdGLEVBQVM2RixlQUFpQkEsR0FFOUJ6RyxFQUFXMkcsUUFBUS9GIiwiZmlsZSI6ImNmLmZlZWRiYWNrLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiBAbmdkb2Mgb3ZlcnZpZXdcbiAqIEBuYW1lIGNmLmZlZWRiYWNrXG4gKiBAZGVzY3JpcHRpb25cbiAqICMgRmVlZGJhY2sgbWFuYWdlbWVudCBtb2R1bGVcbiAqXG4gKiBDb3B5cmlnaHQgKEMpIDIwMTQgQ2hyaXN0aWFuIEtyYW1lclxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZ1xuICogd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgSW5jLixcbiAqIDUxIEZyYW5rbGluIFN0cmVldCwgRmlmdGggRmxvb3IsIEJvc3RvbiwgTUEgMDIxMTAtMTMwMSBVU0EuXG4gKi9cbmFuZ3VsYXIubW9kdWxlKCdjZi5mZWVkYmFjaycsWydwYXNjYWxwcmVjaHQudHJhbnNsYXRlJ10pO1xuIiwiLyoqXG4gKiBAbmdkb2Mgb3ZlcnZpZXdcbiAqIEBuYW1lIGZpbnFBcHAuY29uc3RhbnRzOkVWRU5UU1xuICogQGRlc2NyaXB0aW9uXG4gKiAjIEFwcGxpY2F0aW9uIEV2ZW50c1xuICpcbiAqIEFueSBldmVudCB1c2VkIHRocm91Z2hvdXQgdGhlIGFwcGxpY2F0aW9uIHNob3VsZCBiZSBkZWZpbmVkIGhlcmUgYXMgYSBjb25zdGFudC5cbiAqL1xuXG5hbmd1bGFyLm1vZHVsZSgnY2YuZmVlZGJhY2snKVxuXHQuY29uc3RhbnQoJ0ZFRURCQUNLX1RZUEUnLCB7XG4gICAgICAgICdTVUNDRVNTJzogJ1NVQ0NFU1MnLFxuICAgICAgICAnRVJST1InOiAnRVJST1InLFxuICAgICAgICAnQUxFUlQnOiAnQUxFUlQnLFxuICAgICAgICAnTk9USUNFJzogJ05PVElDRSdcbiAgICB9KTtcblxuIiwiJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIEBuZ2RvYyBvdmVydmlld1xuICogQG5hbWUgZmlucUFwcDpGZWVkYmFja0N0cmxcbiAqIEBkZXNjcmlwdGlvblxuICogIyBGZWVkYmFjayBjb250cm9sbGVyXG4gKlxuICogSGFuZGxlIHJlbmRlcmluZyBhbmQgaXRlcmFjdGlvbiB3aXRoIHVzZXIgZmVlZGJhY2suXG4gKi9cbmFuZ3VsYXIubW9kdWxlKCdjZi5mZWVkYmFjaycpXG4gICAgLmRpcmVjdGl2ZSgnZmVlZGJhY2snLCBmdW5jdGlvbiAoJHRpbWVvdXQsIGNmRmVlZGJhY2spIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZmJPcHRpb25zOiAnPScsXG4gICAgICAgICAgICAgICAgZWxlbWVudElkOiAnQGZlZWRiYWNrJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnRmVlZGJhY2tDdHJsJyxcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXG4gICAgICAgICAgICBjb21waWxlOiBmdW5jdGlvbiAodEVsZW1lbnQsIGF0dHJzLCB0cmFuc2NsdWRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgkc2NvcGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhhbmRsZUZlZWRiYWNrID0gZnVuY3Rpb24oZmVlZGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5oYW5kbGUoZmVlZGJhY2spO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmVsZW1lbnRJZCA9PT0gJycpICRzY29wZS5lbGVtZW50SWQgPSB2b2lkIDA7XG4gICAgICAgICAgICAgICAgICAgIGNmRmVlZGJhY2suc3Vic2NyaWJlKGhhbmRsZUZlZWRiYWNrLCAkc2NvcGUuZWxlbWVudElkKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRvbihcIiRkZXN0cm95XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2ZGZWVkYmFjay51bnN1YnNjcmliZShoYW5kbGVGZWVkYmFjaywgJHNjb3BlLmVsZW1lbnRJZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2NsdWRlKCRzY29wZSwgZnVuY3Rpb24gKGNsb25lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0RWxlbWVudC5hcHBlbmQoY2xvbmUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pLmNvbnRyb2xsZXIoJ0ZlZWRiYWNrQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICR0aW1lb3V0LCBjZkZlZWRiYWNrLCAkdHJhbnNsYXRlLCBGRUVEQkFDS19UWVBFKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcyxcbiAgICAgICAgICAgIGluZGV4ID0gMCxcbiAgICAgICAgICAgIHRpbWVvdXRPdmVycnVsaW5nVHlwZSA9IG51bGwsXG4gICAgICAgICAgICBxdWV1ZSA9IFtdLFxuICAgICAgICAgICAgaGlkaW5nID0gMCxcbiAgICAgICAgICAgIG9wdGlvbnMgPSBjZkZlZWRiYWNrLmdldERlZmF1bHRPcHRpb25zKCk7XG5cbiAgICAgICAgaWYgKCRzY29wZS5mYk9wdGlvbnMpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBhbmd1bGFyLmV4dGVuZCh7fSwgb3B0aW9ucywgJHNjb3BlLmZiT3B0aW9ucyk7XG4gICAgICAgIH1cblxuICAgICAgICAkc2NvcGUuaGFuZGxlID0gZnVuY3Rpb24oZmVlZGJhY2spIHtcbiAgICAgICAgICAgIGhhbmRsZUZlZWRiYWNrKGZlZWRiYWNrKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAob3B0aW9ucy5tYXhNZXNzYWdlcyAhPT0gMSkgJHNjb3BlLmZlZWRiYWNrID0gW107XG5cbiAgICAgICAgdGhpcy5oaWRlID0gZnVuY3Rpb24gKGluZGV4LCB3aGVuRG9uZSkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubWF4TWVzc2FnZXMgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmVlZGJhY2sgPSBudWxsO1xuICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaGlkaW5nLS07XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2hlbkRvbmUgPT09ICdmdW5jdGlvbicpIHdoZW5Eb25lKCk7XG4gICAgICAgICAgICAgICAgfSwgb3B0aW9ucy5yZXBsYWNlVGltZSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRkaWdlc3QoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS5mZWVkYmFjaywgZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuaW5kZXggPT09IGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoaWRpbmcrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRpbWVvdXQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobWVzc2FnZS50aW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmZlZWRiYWNrLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5mZWVkYmFja1tpXS5pbmRleCA9PT0gaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZlZWRiYWNrLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZGluZy0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2hlbkRvbmUgPT09ICdmdW5jdGlvbicpIHdoZW5Eb25lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBvcHRpb25zLnJlcGxhY2VUaW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZGlnZXN0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBoYW5kbGVGZWVkYmFjayA9IGZ1bmN0aW9uIChmZWVkYmFja1NwZWMpIHtcbiAgICAgICAgICAgIHZhciBmZWVkYmFjayA9IHtcbiAgICAgICAgICAgICAgICBzdGF0aWNUeXBlOiBmZWVkYmFja1NwZWMudHlwZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciB0cmFuc2xhdGFibGVNZXNzYWdlID0gdHJhbnNsYXRhYmxlKGZlZWRiYWNrU3BlYy5tZXNzYWdlKTtcbiAgICAgICAgICAgIGlmICh0cmFuc2xhdGFibGVNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgZmVlZGJhY2sucGF0aHMgPSBmaW5kUmVsYXRpdmVGZWVkYmFja1BhdGhzKGZlZWRiYWNrU3BlYy50eXBlLCB0cmFuc2xhdGFibGVNZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB0cmFuc2xhdGVGZWVkYmFjayhmZWVkYmFjayk7XG4gICAgICAgICAgICAgICAgZmVlZGJhY2sucmVmZXJlbmNlID0gZmVlZGJhY2sucGF0aHMucmVmZXJlbmNlO1xuICAgICAgICAgICAgICAgIGZlZWRiYWNrLm1lc3NhZ2UgPSBmZWVkYmFjay5yZWZlcmVuY2UgKyAnICh1bnRyYW5zbGF0ZWQpJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZmVlZGJhY2subWVzc2FnZSA9IGZlZWRiYWNrU3BlYy5tZXNzYWdlO1xuICAgICAgICAgICAgICAgIGZlZWRiYWNrLnJlZmVyZW5jZSA9IGZlZWRiYWNrLm1lc3NhZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmZWVkYmFjay5kZXRhaWxzID0gbnVsbDtcbiAgICAgICAgICAgIGZlZWRiYWNrLnR5cGUgPSBmZWVkYmFja1NwZWMudHlwZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgZmVlZGJhY2suZGF0YSA9IGZlZWRiYWNrU3BlYy5kYXRhO1xuICAgICAgICAgICAgaWYgKGFsbG93UHJvY2Vzc2luZyhmZWVkYmFjaykpIHtcbiAgICAgICAgICAgICAgICBwcm9jZXNzTmV3RmVlZGJhY2tNZXNzYWdlKGZlZWRiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdHJhbnNsYXRhYmxlID0gZnVuY3Rpb24gKGZlZWRiYWNrTWVzc2FnZSkge1xuICAgICAgICAgICAgaWYgKGZlZWRiYWNrTWVzc2FnZVswXSA9PT0gJ3snICYmIGZlZWRiYWNrTWVzc2FnZVtmZWVkYmFja01lc3NhZ2UubGVuZ3RoLTFdID09PSAnfScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmVlZGJhY2tNZXNzYWdlLnN1YnN0cmluZygxLGZlZWRiYWNrTWVzc2FnZS5sZW5ndGgtMSk7XG4gICAgICAgICAgICB9IHJldHVybiBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgYWxsb3dQcm9jZXNzaW5nID0gZnVuY3Rpb24oZmVlZGJhY2spIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmFsbG93RHVwbGljYXRlU3RhY2tlZCkgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB2YXIgYWxsb3cgPSB0cnVlO1xuICAgICAgICAgICAgdmFyIHZhbGlkYXRlTWVzc2FnZSA9IGZ1bmN0aW9uKGN1cnJlbnRGZWVkYmFjaykge1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RmVlZGJhY2sudHlwZSA9PT0gZmVlZGJhY2sudHlwZSAmJiBjdXJyZW50RmVlZGJhY2sucmVmZXJlbmNlID09PSBmZWVkYmFjay5yZWZlcmVuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgYWxsb3cgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubWF4TWVzc2FnZXMgPT09IDEgJiYgJHNjb3BlLmZlZWRiYWNrKSB2YWxpZGF0ZU1lc3NhZ2UoJHNjb3BlLmZlZWRiYWNrKTtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUuZmVlZGJhY2ssIGZ1bmN0aW9uIChjdXJyZW50RmVlZGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVNZXNzYWdlKGN1cnJlbnRGZWVkYmFjayk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBhbGxvdztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcHJvY2Vzc05ld0ZlZWRiYWNrTWVzc2FnZSA9IGZ1bmN0aW9uKGZlZWRiYWNrKSB7XG4gICAgICAgICAgICBpZiAoKG9wdGlvbnMubWF4TWVzc2FnZXMgPT09IDEgJiYgJHNjb3BlLmZlZWRiYWNrKSB8fCAob3B0aW9ucy5tYXhNZXNzYWdlcyAhPT0gMSAmJiAkc2NvcGUuZmVlZGJhY2subGVuZ3RoK2hpZGluZyA+PSBvcHRpb25zLm1heE1lc3NhZ2VzKSkge1xuICAgICAgICAgICAgICAgIGNsZWFyT3JVcGRhdGVRdWV1ZWQoRkVFREJBQ0tfVFlQRS5OT1RJQ0UpO1xuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1heE1lc3NhZ2VzID09PSAxICYmIGZlZWRiYWNrLnJlZmVyZW5jZSA9PT0gJHNjb3BlLmZlZWRiYWNrLnJlZmVyZW5jZSAmJiAhcXVldWUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcGxhY2VGZWVkYmFjayhmZWVkYmFjayk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcXVldWVGZWVkYmFjayhmZWVkYmFjayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzaG93RmVlZGJhY2soZmVlZGJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBmaW5kUmVsYXRpdmVGZWVkYmFja1BhdGhzID0gZnVuY3Rpb24gKGZlZWRiYWNrVHlwZSwgcmVmZXJlbmNlKSB7XG4gICAgICAgICAgICB2YXIgdHJhbnNsYXRpb25zID0gY2ZGZWVkYmFjay5saXN0VHJhbnNsYXRpb25zKCk7XG4gICAgICAgICAgICBpZiAoIXRyYW5zbGF0aW9ucy5GRUVEQkFDSykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGZpbmQgYSBGRUVEQkFDSyByb290IGNvbnN0YW50IHJlZmVyZW5jZSBpbiB5b3VyIGxvYWRlZCB0cmFuc2xhdGlvbnMgZmlsZS4gTWFrZSBzdXJlIHRoZXJlIGlzIGEgcm9vdCBpdGVtIGNhbGxlZCBGRUVEQkFDSyBpbiB5b3VyIHRyYW5zbGF0aW9uIGZpbGUgd2hpY2ggY29udGFpbnMgYWxsIHN0cnVjdHVyZWQgc3VwcG9ydGVkIGZlZWRiYWNrIG1lc3NhZ2VzLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlZiA9IHJlZmVyZW5jZS5zcGxpdCgnLicpO1xuICAgICAgICAgICAgdmFyIHRyYXZlcnNlZCwgbGFzdE1lc3NhZ2VQYXRoLCBwYXRoID0gJycsIGZiO1xuICAgICAgICAgICAgdHJhdmVyc2VkID0gdHJhbnNsYXRpb25zLkZFRURCQUNLW2ZlZWRiYWNrVHlwZV07XG4gICAgICAgICAgICBpZiAoIXRyYXZlcnNlZCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGZpbmQgRkVFREJBQ0suJytmZWVkYmFja1R5cGUrJyBpbiB5b3VyIHRyYW5zbGF0aW9uIGZpbGUuIE1ha2Ugc3VyZSB5b3UgZ3JvdXAgeW91ciBmZWVkYmFjayBieSB0eXBlIGluIHRoZSB0cmFuc2xhdGlvbiBmaWxlLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWYubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBwYXRoICs9IGkgPiAwID8gJy4nK3JlZltpXSA6IHJlZltpXTtcbiAgICAgICAgICAgICAgICBpZiAodHJhdmVyc2VkW3JlZltpXV0pIHtcbiAgICAgICAgICAgICAgICAgICAgdHJhdmVyc2VkID0gdHJhdmVyc2VkW3JlZltpXV07XG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmF2ZXJzZWQuX01FU1NBR0UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RNZXNzYWdlUGF0aCA9IHBhdGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0cmF2ZXJzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RNZXNzYWdlUGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygndW50cmFuc2xhdGVkICcrZmVlZGJhY2tUeXBlLnRvTG93ZXJDYXNlKCkrJyBmZWVkYmFjayByZWZlcmVuY2UgcHJvdmlkZWQ6ICcrcmVmZXJlbmNlKycuIEZhbGxpbmcgYmFjayB0byBtb3N0IHNwZWNpZmljIG1lc3NhZ2U6ICcrbGFzdE1lc3NhZ2VQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZiID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogJ1VOS05PV04nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdVTktOT1dOJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoJ3VudHJhbnNsYXRlZCAnK2ZlZWRiYWNrVHlwZS50b0xvd2VyQ2FzZSgpKycgZmVlZGJhY2sgcmVmZXJlbmNlIHByb3ZpZGVkOiAnK3JlZmVyZW5jZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRyYXZlcnNlZCkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdHJhdmVyc2VkID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICBmYiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogcmVmZXJlbmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbGFzdE1lc3NhZ2VQYXRoXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIGZiID0gcmVmZXJlbmNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZiO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBzaG93RmVlZGJhY2sgPSBmdW5jdGlvbiAoZmVlZGJhY2ssIHRpbWVvdXQpIHtcbiAgICAgICAgICAgIGZlZWRiYWNrLmluZGV4ID0gaW5kZXgrKztcbiAgICAgICAgICAgIGlmIChpbmRleCA+IG9wdGlvbnMubWF4TWVzc2FnZXMqMikgaW5kZXggPSAwO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMubWF4TWVzc2FnZXMgIT09IDEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmVlZGJhY2sucHVzaChmZWVkYmFjayk7XG4gICAgICAgICAgICB9IGVsc2UgJHNjb3BlLmZlZWRiYWNrID0gZmVlZGJhY2s7XG4gICAgICAgICAgICB0aW1lb3V0RmVlZGJhY2soZmVlZGJhY2ssIHRpbWVvdXQgfHwgb3B0aW9ucy5jbGVhblRpbWVvdXQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBxdWV1ZUZlZWRiYWNrID0gZnVuY3Rpb24gKGZlZWRiYWNrKSB7XG4gICAgICAgICAgICB2YXIgZmlyc3RJdGVtID0gb3B0aW9ucy5tYXhNZXNzYWdlcyA9PT0gMSA/ICRzY29wZS5mZWVkYmFjayA6ICRzY29wZS5mZWVkYmFja1swXTtcbiAgICAgICAgICAgIGlmICh0aW1lb3V0T3ZlcnJ1bGluZ1R5cGUgPT09IG51bGwgfHwgKHRpbWVvdXRPdmVycnVsaW5nVHlwZSA9PT0gRkVFREJBQ0tfVFlQRS5OT1RJQ0UgJiYgZmVlZGJhY2suc3RhdGljVHlwZSAhPT0gRkVFREJBQ0tfVFlQRS5OT1RJQ0UpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZlZWRiYWNrLnN0YXRpY1R5cGUgIT09IEZFRURCQUNLX1RZUEUuTk9USUNFKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXRGZWVkYmFjayhmaXJzdEl0ZW0sIG9wdGlvbnMubWluVGltZW91dCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dEZlZWRiYWNrKGZpcnN0SXRlbSwgb3B0aW9ucy5xdWV1ZVRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aW1lb3V0T3ZlcnJ1bGluZ1R5cGUgPSBmZWVkYmFjay5zdGF0aWNUeXBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFjbGVhck9yVXBkYXRlUXVldWVkKGZlZWRiYWNrKSkge1xuICAgICAgICAgICAgICAgIHF1ZXVlLnB1c2goZmVlZGJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciByZXBsYWNlRmVlZGJhY2sgPSBmdW5jdGlvbiAoZmVlZGJhY2spIHtcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGF0LmhpZGUoZmVlZGJhY2tbMF0uaW5kZXgsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2hvd0ZlZWRiYWNrKGZlZWRiYWNrKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGRpZ2VzdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHRpbWVvdXRGZWVkYmFjayA9IGZ1bmN0aW9uIChmZWVkYmFjaywgdGltZW91dCkge1xuICAgICAgICAgICAgZmVlZGJhY2sudGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoYXQuaGlkZShmZWVkYmFjay5pbmRleCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZXZhbHVhdGVRdWV1ZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0T3ZlcnJ1bGluZ1R5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRkaWdlc3QoKTtcbiAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBldmFsdWF0ZVF1ZXVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHF1ZXVlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHZhciBuZXh0VGltZW91dDtcbiAgICAgICAgICAgICAgICBpZiAocXVldWUubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXVldWVbMV0uc3RhdGljVHlwZSAhPT0gRkVFREJBQ0tfVFlQRS5OT1RJQ0UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRUaW1lb3V0ID0gb3B0aW9ucy5taW5UaW1lb3V0O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dFRpbWVvdXQgPSBvcHRpb25zLnF1ZXVlVGltZW91dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG5leHRUaW1lb3V0ID0gb3B0aW9ucy5jbGVhblRpbWVvdXQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNob3dGZWVkYmFjayhxdWV1ZVswXSwgbmV4dFRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIHF1ZXVlLnNwbGljZSgwLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBxdWV1ZS5sZW5ndGg7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGNsZWFyT3JVcGRhdGVRdWV1ZWQgPSBmdW5jdGlvbiAoZmVlZGJhY2spIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAocXVldWVbaV0uc3RhdGljVHlwZSA9PT0gZmVlZGJhY2suc3RhdGljVHlwZSAmJiAoIWZlZWRiYWNrIHx8IHF1ZXVlW2ldLnJlZmVyZW5jZSA9PT0gZmVlZGJhY2sucmVmZXJlbmNlKSkge1xuICAgICAgICAgICAgICAgICAgICBxdWV1ZS5zcGxpY2UoaS0tLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdHJhbnNsYXRlRmVlZGJhY2sgPSBmdW5jdGlvbihmZWVkYmFjaykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBmZWVkYmFjay5wYXRocyA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAkdHJhbnNsYXRlKCdGRUVEQkFDSy4nICsgZmVlZGJhY2suc3RhdGljVHlwZSArICcuJyArIGZlZWRiYWNrLnBhdGhzLm1lc3NhZ2UgKyAnLl9NRVNTQUdFJywgZmVlZGJhY2suZGF0YSkudGhlbihmdW5jdGlvbiAodHJhbnNsYXRlZEZlZWRiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGZlZWRiYWNrLm1lc3NhZ2UgPSB0cmFuc2xhdGVkRmVlZGJhY2s7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJHRyYW5zbGF0ZSgnRkVFREJBQ0suJyArIGZlZWRiYWNrLnN0YXRpY1R5cGUgKyAnLicgKyBmZWVkYmFjay5wYXRocy5yZWZlcmVuY2UgKyAnLl9ERVRBSUxTJywgZmVlZGJhY2suZGF0YSkudGhlbihmdW5jdGlvbiAodHJhbnNsYXRlZEZlZWRiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGZlZWRiYWNrLmRldGFpbHMgPSB0cmFuc2xhdGVkRmVlZGJhY2s7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICR0cmFuc2xhdGUoJ0ZFRURCQUNLLicgKyBmZWVkYmFjay5zdGF0aWNUeXBlICsgJy4nICsgZmVlZGJhY2sucGF0aHMsIGZlZWRiYWNrLmRhdGEpLnRoZW4oZnVuY3Rpb24gKHRyYW5zbGF0ZWRGZWVkYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBmZWVkYmFjay5tZXNzYWdlID0gdHJhbnNsYXRlZEZlZWRiYWNrO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9KTtcbiIsIid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiBAbmdkb2MgZnVuY3Rpb25cbiAqIEBuYW1lIGNmLmZlZWRiYWNrOmNmRmVlZGJhY2tNYW5hZ2VyXG4gKiBAZGVzY3JpcHRpb25cbiAqICMgRmVlZGJhY2sgbWFuYWdlbWVudCBzZXJ2aWNlXG4gKlxuICogQSBzdXBwb3J0IHNlcnZpY2UgdG8gaGFuZGxlIHN1YnNjcmlwdGlvbnMgYW5kIHB1YmxpY2F0aW9ucyBvZiBmZWVkYmFjayByZWxhdGVkIGFjdGlvbnMuXG4gKi9cbmFuZ3VsYXIubW9kdWxlKCdjZi5mZWVkYmFjaycpXG4gICAgLnByb3ZpZGVyKCdjZkZlZWRiYWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0cmFuc2xhdGlvbkxpc3RGbiwgdHJhbnNsYXRpb25GbiwgdHJhbnNsYXRlID0gZmFsc2U7XG4gICAgICAgIHZhciBsaXN0ZW5lcnMgPSB7XG4gICAgICAgICAgICBnbG9iYWw6IFtdLFxuICAgICAgICAgICAgaWRlbnRpZmllZDoge31cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICAgICAgcmVwbGFjZVRpbWU6IDMwMCxcbiAgICAgICAgICAgIGNsZWFuVGltZW91dDogNjAwMCxcbiAgICAgICAgICAgIHF1ZXVlVGltZW91dDogMzAwMCxcbiAgICAgICAgICAgIG1pblRpbWVvdXQ6IDEwMDAsXG4gICAgICAgICAgICBhbGxvd0R1cGxpY2F0ZVN0YWNrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgbWF4TWVzc2FnZXM6IDFcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29uZmlndXJlVHJhbnNsYXRpb25zOiBmdW5jdGlvbiAobGlzdEZuLCB0cmFuc2xhdGVGbikge1xuICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9uTGlzdEZuID0gbGlzdEZuO1xuICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9uRm4gPSB0cmFuc2xhdGVGbjtcbiAgICAgICAgICAgICAgICB0cmFuc2xhdGUgPSB0cnVlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgY29uZmlndXJlRGVmYXVsdE9wdGlvbnM6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgZGVmYXVsdE9wdGlvbnMgPSBhbmd1bGFyLmV4dGVuZCh7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZTogZnVuY3Rpb24gKGNhbGxiYWNrLCBjb250ZXh0RWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHRFbGVtZW50ID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnMuZ2xvYmFsLnB1c2goY2FsbGJhY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcnMuaWRlbnRpZmllZFtjb250ZXh0RWxlbWVudF0gPSBsaXN0ZW5lcnMuaWRlbnRpZmllZFtjb250ZXh0RWxlbWVudF0gfHwgW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXJzLmlkZW50aWZpZWRbY29udGV4dEVsZW1lbnRdLnB1c2goY2FsbGJhY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIHVuc3Vic2NyaWJlOiBmdW5jdGlvbiAoY2FsbGJhY2ssIGNvbnRleHRFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0TGlzdCA9IGNvbnRleHRFbGVtZW50ID09PSB2b2lkIDAgPyBsaXN0ZW5lcnMuZ2xvYmFsIDogbGlzdGVuZXJzLmlkZW50aWZpZWRbY29udGV4dEVsZW1lbnRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YXJnZXRMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldExpc3RbaV0gPT09IGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldExpc3Quc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgcHVibGlzaDogZnVuY3Rpb24gKGZlZWRiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0TGlzdCA9IGZlZWRiYWNrLmNvbnRleHRFbGVtZW50ID09PSB2b2lkIDAgPyBsaXN0ZW5lcnMuZ2xvYmFsIDogbGlzdGVuZXJzLmlkZW50aWZpZWRbZmVlZGJhY2suY29udGV4dEVsZW1lbnRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YXJnZXRMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0YXJnZXRMaXN0W2ldID09PSAnZnVuY3Rpb24nKSB0YXJnZXRMaXN0W2ldKGZlZWRiYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBnZXREZWZhdWx0T3B0aW9uczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRPcHRpb25zO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGxpc3RUcmFuc2xhdGlvbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2xhdGlvbkxpc3RGbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmFuc2xhdGUpIHJldHVybiBhcmd1bWVudHNbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNsYXRpb25Gbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9KTtcblxuXG4vKipcbiAqIEBuZ2RvYyBmdW5jdGlvblxuICogQG5hbWUgY2YuZmVlZGJhY2s6JGZlZWRiYWNrXG4gKiBAZGVzY3JpcHRpb25cbiAqICMgRmVlZGJhY2sgaGFuZGxpbmcgc2VydmljZVxuICpcbiAqIEEgZ2VuZXJpYyBzZXJ2aWNlIHRvIGhhbmRsZSB0aGUgZGlzcGxheWluZyBvZiBhbGwgZmVlZGJhY2sgdG8gdGhlIHVzZXIuXG4gKi9cbmFuZ3VsYXIubW9kdWxlKCdjZi5mZWVkYmFjaycpXG4gICAgLnNlcnZpY2UoJyRmZWVkYmFjaycsIGZ1bmN0aW9uIChjZkZlZWRiYWNrLCBGRUVEQkFDS19UWVBFKSB7XG5cbiAgICAgICAgdGhpcy5lcnJvciA9IGZ1bmN0aW9uIChtZXNzYWdlLCBkYXRhLCBjb250ZXh0RWxlbWVudCkge1xuICAgICAgICAgICAgZGlzcGF0Y2hGZWVkYmFjayhGRUVEQkFDS19UWVBFLkVSUk9SLCBtZXNzYWdlLCBkYXRhLCBjb250ZXh0RWxlbWVudCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5ub3RpY2UgPSBmdW5jdGlvbiAobWVzc2FnZSwgZGF0YSwgY29udGV4dEVsZW1lbnQpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoRmVlZGJhY2soRkVFREJBQ0tfVFlQRS5OT1RJQ0UsIG1lc3NhZ2UsIGRhdGEsIGNvbnRleHRFbGVtZW50KTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnN1Y2Nlc3MgPSBmdW5jdGlvbiAobWVzc2FnZSwgZGF0YSwgY29udGV4dEVsZW1lbnQpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoRmVlZGJhY2soRkVFREJBQ0tfVFlQRS5TVUNDRVNTLCBtZXNzYWdlLCBkYXRhLCBjb250ZXh0RWxlbWVudCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5hbGVydCA9IGZ1bmN0aW9uIChtZXNzYWdlLCBkYXRhLCBjb250ZXh0RWxlbWVudCkge1xuICAgICAgICAgICAgZGlzcGF0Y2hGZWVkYmFjayhGRUVEQkFDS19UWVBFLkFMRVJULCBtZXNzYWdlLCBkYXRhLCBjb250ZXh0RWxlbWVudCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGRpc3BhdGNoRmVlZGJhY2sgPSBmdW5jdGlvbiAodHlwZSwgbWVzc2FnZSwgZGF0YSwgY29udGV4dEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciBmZWVkYmFjayA9IHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxuICAgICAgICAgICAgICAgIHR5cGU6IHR5cGVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZmVlZGJhY2suZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29udGV4dEVsZW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGZlZWRiYWNrLmNvbnRleHRFbGVtZW50ID0gY29udGV4dEVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjZkZlZWRiYWNrLnB1Ymxpc2goZmVlZGJhY2spO1xuICAgICAgICB9O1xuXG4gICAgfSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
